---
version: "3.9"
services:
  app:
    build: .
    ports: ["3000:3000"]
    env_file: .env
    volumes: ["bundler_gems:/bundler_gems"]
    depends_on: [db, sidekiq]
    command:  bin/rails server -p 3000 -b 0.0.0.0
  db:
    image: postgres:14.2
    ports: ["5432:5432"]
    volumes: ["biddy-db:/etc/data"]
    env_file: .env
  sidekiq:
    build:
      context: .
    volumes: ["bundler_gems:/bundler_gems"]
    command: bin/bundle exec sidekiq
    env_file: .env
    depends_on: [redis]
    environment: ["REDIS_URL=redis://redis:6379/0"]
  redis:
    image: redis:7.0
    ports: ["6379:6379"]
    volumes: ["biddy-redis:/var/lib/redis/data"]
volumes:
  biddy-db:
  biddy-redis:
  bundler_gems:
